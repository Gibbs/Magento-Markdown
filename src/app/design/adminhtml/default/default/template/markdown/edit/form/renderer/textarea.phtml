<?php
/** @var $this SchumacherFM_Markdown_Block_Adminhtml_Form_Renderer_Fieldset_Element_Textarea */
// @todo rewrite to <script type="text/template"> ... and include only once
?>
<div class="mdTabContainer" style="display:none;">
    <div class="mdTabs">
        <ul data-current="write">
            <li id="<?php echo $this->getElementId(); ?>__write" class="active"><?php echo $this->___('Write') ?></li>
            <li id="<?php echo $this->getElementId(); ?>__preview" class=""><?php echo $this->___('Preview') ?></li>
            <li id="<?php echo $this->getElementId(); ?>__livePreview" class=""><?php echo $this->___('Live Preview') ?></li>
            <li id="<?php echo $this->getElementId(); ?>__htmlPreview" class=""><?php echo $this->___('HTML Preview') ?></li>
        </ul>
        <div class="mdParserInfo"><?php echo $this->___('Content is parsed with') ?>
            <a target="_blank" href="<?php echo Mage::helper('markdown')->getCheatSheetUrl(); ?>">Markdown</a>
            <?php if (Mage::helper('markdown')->isMarkdownExtra()): ?>
                <?php echo $this->___('and') ?> <a target="_blank" href="<?php echo Mage::helper('markdown')->getMdExtraDocUrl(); ?>">Markdown Extra</a>
            <?php endif; ?>
        </div>
    </div>
    <div class="mdTabscontent">
        <div class="mdTabpage active" id="<?php echo $this->getElementId(); ?>__writeB">
            <?php echo $this->getAfterElementHtml(); ?>
            <div class="mdTextArea"></div>
            <p class="md-filereader-text"><?php echo $this->___('Attach images by dragging & dropping,') ?>
                <input type="file" multiple="multiple" id="<?php echo $this->getFileReaderInputId() ?>" class="md-manual-file-chooser">
                <a href="#"><?php echo $this->___('selecting them') ?></a>,
                <?php echo $this->___('or pasting from the clipboard.') ?> </p>
        </div>
        <div class="mdTabpage" id="<?php echo $this->getElementId(); ?>__previewB">
            <?php echo $this->getIframe('__previewB', FALSE); ?>
        </div>
        <div class="mdTabpage" id="<?php echo $this->getElementId(); ?>__livePreviewB">
            <ul class="previewUrls"></ul>
            <?php echo $this->getIframe('__livePreviewB'); ?>
        </div>
        <div class="mdTabpage" id="<?php echo $this->getElementId(); ?>__htmlPreviewB">
            <?php echo $this->getIframe('__htmlPreviewB', FALSE); ?>
        </div>
    </div>
    <?php
    /**
     * this piece of js code will be injected into the iframe (above) via src="data:text/html,..." attribute
     * in file src/js/markdown/adminhtml/markdown.js line 695
     */
    ?>
    <script type="text/template" id="<?php echo $this->getElementId(); ?>__iFrameJS">
        var sTimeOut, st = ~~'~~scrollto~~';
        window.onload=function(){ if(st>0){ window.scrollTo(0,st);} }
        window.onscroll=function(event){
            if(sTimeOut){clearTimeout(sTimeOut);}
            sTimeOut = setTimeout(function(){
                var target = event.target || event.srcElement,
                    doc = target.documentElement, body = document.body,
                    top = (doc && doc.scrollTop  || body && body.scrollTop  || 0);
                    window.top.postMessage('~~id~~='+top,'~~origin~~');
            },90);
        }
    </script>
</div>